# Validation
---
> 입력을 잘못하거나, 고객이 무언가 실수를 했을 때 우리는 친절하게 알려주어야 한다.  
> 뜬금없는 오류페이지를 출력한다거나 하면 고객이 입력한 값들이 모두 날아가버린다.  
> 따라서 우리는 검증 Logic을 통해 오류 메시지를 정확히 띄워주도록 해야 한다!  

- Client단의 검증
  - Javascript를 통한 검증
  - 하지만 취약점이 발생할 가능성이 높다.
- Server단의 검증
  - HTTP 요청에 대한 검증을 한다.
  - 고객에 대한 즉각적인 고객 사용성이 부족하다(오류 페이지 출력).
- 따라서 둘을 적절히 섞어서 사용하는 것이 중요하다!

## BindingResult
> ```BindingResult```는 오류 메시지 출력에 있어서 매우 용이한 Class이다.  

- BindingResult의 Method인 ```addError()```을 이용해 오류 메시지를 다룰 수 있다.
- Field Error : 특정 값에 오류가 있을 때.
```java
if(!StringUtils.hasText(item.getItemName())){
  bindingResult.addError(new FieldError("item", "itemName", "상품 이름은 필수입니다.");
}

if(item.getPrice == null || item.getPrice() < 1000 || item.getPrice() > 1000000){
  bindingResult.addError(new FieldError("item", "price", "가격은 1,000 ~ 1,000,000까지 허용합니다.");
}
```
- Object Error : 특정 값이 아닌 전체에서 예외가 발생했을 때
```java
if(item.getPrice() != null && item.getQuantity() != null){
  int resultPrice = item.getPrice() * item.getQuantity();
  if(resultPrice < 10000){
    bindingResult.addError(new ObjectError("item", "가격과 수량의 곱은 10,000원 이상이어야 합니다. 현재 값 = " + resultPrice));
  }
}
```
- 그리고 추가로 Error가 발생했을 때 오류 페이지로 보내는 것이 아닌, 그 화면에서 그대로 메시지만 띄워야 한다.
```java
if(bindingResult.hasErrors()){
  return "validation/v2/addForm";
}
```  

### HTML 수정
> 이렇게 Controller을 만들어 주었다면, 이번엔 View를 띄울 HTML Form을 수정해야 한다.  
- Object Error
```HTML
<div th:if="${#fields.hasGlobalErrors()}"
     <p class="field-error" th:each="err : ${#fields.globalErrors()}" th:text="${err}">글로벌 오류 메시지</p>
</div>
```
  - Object Error은 ```#fields``` 를 통해 BindingResult가 제공하는 오류에 접근할 수 있다.
- Field Error
```HTML
<div>
  <label for="itemName" th:text="#{label.item.itemName}">상품명</label>
  <input type="text" id="itemName" th:field="*{itemName}"
         th:errorclass="field-error" class="form-control" placeholder = "이름을 입력하세요">
  <div class="field-error" th:errors="*{itemName}"> 상품명 오류 </div>
</div>
```
  - ```th:errorclass``` 를 통해 오류가 있을 때만 class를 추가해서 Textbox를 빨갛게 바꾸는 등의 동적 출력을 할 수 있다.
  - ```th:errors```를 통해 원래는 ```th:if```를 이용해서 오류가 있으면, Map 내에서 그 키에 해당하는 Value를 찾아서 출력해주어야 하지만
    - 간편하게 BindingResult를 통해 등록했던 오류 이름만으로도 출력이 가능하다!
 


## Validator의 분리
